function Kuzzle(t){var e={};return t&&""!==t?this instanceof Kuzzle?(this.socket=io(t),this.subscribe=function(t,i,o){var n=Math.uuid();return this.socket.once(n,function(t){return t.error?(console.error(t.error),!1):(e[n]=t.result,this.socket.off(t.result),void this.socket.on(t.result,function(t){o(t)}))}.bind(this)),this.socket.emit("subscribe",{requestId:n,action:"on",collection:t,body:i}),n},this.unsubscribe=function(t){return e[t]?(this.socket.emit("subscribe",{requestId:t,action:"off"}),this.socket.off(e[t]),void delete e[t]):!1},this.write=function(t,e,i,o,n){var r=Math.uuid();n&&this.socket.once(r,function(t){n(t)}),void 0===o&&(o=!1),this.socket.emit("write",{requestId:r,action:e,persist:o,collection:t,body:i})},this.create=function(t,e,i,o){this.write(t,"create",e,i,o)},this.update=function(t,e,i){this.write(t,"update",e,!0,i)},this["delete"]=function(t,e,i){var o={_id:e};this.write(t,"delete",o,!0,i)},this.deleteByQuery=function(t,e,i){this.write(t,"deleteByQuery",e,!0,i)},this.search=function(t,e,i){this.readWithQuery(t,e,"search",i)},this.get=function(t,e,i){var o=Math.uuid();this.socket.once(o,function(t){i(t)}),this.socket.emit("read",{requestId:o,action:"get",collection:t,_id:e})},this.count=function(t,e,i){var o=Math.uuid();this.socket.once(o,function(t){i(t)}),this.socket.emit("read",{requestId:o,action:"count",collection:t,body:e})},void(this.readWithQuery=function(t,e,i,o){var n=Math.uuid();this.socket.once(n,function(t){o(t)});var r={requestId:n,action:i,collection:t};if(Object.keys(e).length>1){var s;for(s in e)e.hasOwnProperty(s)&&(r[s]=e[s])}else r.body=e;this.socket.emit("read",r)})):new Kuzzle(t):(console.error("Url to Kuzzle can't be empty"),!1)}!function(){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,i){var o,n=t,r=[];if(i=i||n.length,e)for(o=0;e>o;o++)r[o]=n[0|Math.random()*i];else{var s;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",o=0;36>o;o++)r[o]||(s=0|16*Math.random(),r[o]=n[19==o?3&s|8:s])}return r.join("")},Math.uuidFast=function(){for(var e,i=t,o=new Array(36),n=0,r=0;36>r;r++)8==r||13==r||18==r||23==r?o[r]="-":14==r?o[r]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,o[r]=i[19==r?3&e|8:e]);return o.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})}}();
